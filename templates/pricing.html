{% extends "base.html" %}
{% block content %}
<h1 style="margin-bottom:16px">تسعير الكهرباء</h1>


<form method="post" dir="rtl" class="pricing-form">
  <div style="display:flex;gap:12px;align-items:end;margin-bottom:10px">
    <div>
      <label>العملة</label>
      <select name="currency_code">
        <option value="LBP" {{ 'selected' if (p.currency_code or 'LBP') == 'LBP' else '' }}>LBP (ليرة)</option>
        <option value="USD" {{ 'selected' if (p.currency_code or 'LBP') == 'USD' else '' }}>$ USD</option>
      </select>
    </div>
    <div>
      <label>سعر الصرف (ل.ل لكل $)</label>
      <input type="number" step="0.01" min="0" name="usd_rate" value="{{ p.usd_rate or 90000 }}">
    </div>
    <div style="opacity:.8;font-size:.9em;line-height:1.2">
      <div>عند اختيار $، يتم حفظ القيم داخلياً بالليرة وتُعرض بالدولار بحسب سعر الصرف.</div>
    </div>
  </div>
  <table class="plain">

    <tr>
      <th>سعر الكيلوواط (unit_price)</th>
      <td><input type="number" name="unit_price" step="0.0001" value="{{ (dp.unit_price if dp else p.unit_price) or 0 }}" required></td>
    </tr>
    <tr>
      <th>رسم اشتراك 20A</th>
      <td><input type="number" name="fee_20" step="0.01" value="{{ (dp.fee_20 if dp else p.fee_20) or 0 }}" required></td>
    </tr>
    <tr>
      <th>رسم اشتراك 15A</th> <!-- NEW -->
      <td><input type="number" name="fee_15" step="0.01" value="{{ (dp.fee_15 if dp else p.fee_15) or 0 }}" required></td>
    </tr>
    <tr>
      <th>رسم اشتراك 10A</th>
      <td><input type="number" name="fee_10" step="0.01" value="{{ (dp.fee_10 if dp else p.fee_10) or 0 }}" required></td>
    </tr>
    <tr>
      <th>رسم اشتراك 5A</th>
      <td><input type="number" name="fee_5" step="0.01" value="{{ (dp.fee_5 if dp else p.fee_5) or 0 }}" required></td>
    </tr>
  </table>

  <div class="actions">
    <button class="btn" type="submit">حفظ</button>
    <a class="btn ghost" href="{{ url_for('index') }}">رجوع</a>
  </div>
</form>

<hr style="margin:24px 0">

<h2 style="margin-bottom:12px">تحديث سعر الكيلوواط/ساعة لفواتير شهر محدد</h2>
<form method="post" action="{{ url_for('bulk_update_unit_price') }}" dir="rtl" class="pricing-form">
  <div style="display:flex;gap:12px;align-items:end;flex-wrap:wrap;margin-bottom:10px">
    <div>
      <label>الشهر</label>
      <select name="month" required>
        {% for m in range(1,13) %}
          <option value="{{ m }}">{{ "%02d"|format(m) }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>السنة</label>
      <input type="number" name="year" min="2000" max="2100" value="{{ (now.year) if (now) else 2025 }}" required>
    </div>
    <div>
      <label>سعر الك.و.س (ليرة لبنانية)</label>
      <input type="number" name="unit_price_input" step="0.01" placeholder="مثال: 0.15 أو 15000" required>
    </div>
  </div>
  <div class="actions">
    <button class="btn danger" type="submit" onclick="return confirm('هل أنت متأكد من تحديث جميع الفواتير في هذا الشهر؟');">تحديث جماعي</button>
  </div>
</form>

<style>
  .pricing-form{max-width:560px;margin:0 auto}
  .pricing-form table.plain{width:100%;border-collapse:collapse}
  .pricing-form th,.pricing-form td{padding:8px 6px;text-align:right;vertical-align:middle}
  .pricing-form th{white-space:nowrap;color:#111}
  .pricing-form input[type=number]{width:100%;height:36px;padding:0 10px;border:1px solid #d9dde5;border-radius:10px}
  .pricing-form .actions{margin-top:14px;display:flex;gap:10px}
  .btn{border:1px solid #4f46e5;background:#4f46e5;color:#fff;padding:8px 14px;border-radius:12px;text-decoration:none}
  .btn.ghost{background:#fff;color:#4f46e5}
</style>
{% endblock %}
